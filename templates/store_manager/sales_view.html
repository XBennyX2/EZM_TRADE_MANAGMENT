{% extends 'base.html' %}

{% block content %}
<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
  .sales-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: none;
    border-radius: 0.75rem;
    box-shadow: 0 0.25rem 1rem rgba(0, 0, 0, 0.05);
  }

  .sales-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1);
  }

  .sales-header {
    background: linear-gradient(90deg, #28a745, #20c997);
    color: white;
    border-radius: 0.75rem 0.75rem 0 0;
    padding: 1rem 1.5rem;
  }

  .stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 1rem;
    padding: 1.5rem;
    text-align: center;
  }

  .stat-card.today {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  }

  .stat-card.week {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  }

  .stat-card.month {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  }
</style>

<div class="container mt-4">
  <!-- Header -->
  <div class="sales-card mb-4">
    <div class="sales-header">
      <h3 class="mb-0"><i class="bi bi-graph-up"></i> Sales Dashboard - {{ manager_store.name }}</h3>
    </div>
    <div class="card-body">
      <p class="mb-0">Monitor your store's sales performance and revenue analytics.</p>
    </div>
  </div>

  <!-- Sales Statistics -->
  <div class="row mb-4">
    <div class="col-md-4 mb-3">
      <div class="stat-card today">
        <i class="bi bi-calendar-day display-4 mb-3"></i>
        <h4>Today's Sales</h4>
        <h2>${{ today_sales|floatformat:2 }}</h2>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="stat-card week">
        <i class="bi bi-calendar-week display-4 mb-3"></i>
        <h4>This Week</h4>
        <h2>${{ week_sales|floatformat:2 }}</h2>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="stat-card month">
        <i class="bi bi-calendar-month display-4 mb-3"></i>
        <h4>This Month</h4>
        <h2>${{ month_sales|floatformat:2 }}</h2>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <ul class="nav nav-tabs mb-4" id="salesTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="transactions-tab" data-bs-toggle="tab" data-bs-target="#transactions" type="button" role="tab">
        <i class="bi bi-receipt"></i> Recent Transactions
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="financial-tab" data-bs-toggle="tab" data-bs-target="#financial" type="button" role="tab">
        <i class="bi bi-cash-stack"></i> Financial Records
      </button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content" id="salesTabsContent">
    <!-- Transactions Tab -->
    <div class="tab-pane fade show active" id="transactions" role="tabpanel">
      <div class="card sales-card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-receipt"></i> Recent Sales Transactions</h5>
        </div>
        <div class="card-body">
          {% if sales_transactions %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Transaction ID</th>
                  <th>Date & Time</th>
                  <th>Type</th>
                  <th>Quantity</th>
                  <th>Total Amount</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for transaction in sales_transactions %}
                <tr>
                  <td><strong>#{{ transaction.id }}</strong></td>
                  <td>{{ transaction.timestamp|date:"M d, Y H:i" }}</td>
                  <td>
                    <span class="badge bg-info">{{ transaction.transaction_type|title }}</span>
                  </td>
                  <td>{{ transaction.quantity }}</td>
                  <td><strong>${{ transaction.total_amount|floatformat:2 }}</strong></td>
                  <td>
                    <span class="badge bg-success">Completed</span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="bi bi-receipt display-1 text-muted"></i>
            <h4 class="text-muted mt-3">No Transactions</h4>
            <p class="text-muted">No sales transactions found for your store.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Financial Records Tab -->
    <div class="tab-pane fade" id="financial" role="tabpanel">
      <div class="card sales-card">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="bi bi-cash-stack"></i> Financial Records</h5>
        </div>
        <div class="card-body">
          {% if financial_records %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Record ID</th>
                  <th>Date & Time</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Cashier</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                {% for record in financial_records %}
                <tr>
                  <td><strong>#{{ record.id }}</strong></td>
                  <td>{{ record.timestamp|date:"M d, Y H:i" }}</td>
                  <td>
                    {% if record.record_type == 'revenue' %}
                      <span class="badge bg-success">Revenue</span>
                    {% else %}
                      <span class="badge bg-danger">Expense</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if record.record_type == 'revenue' %}
                      <span class="text-success">+${{ record.amount|floatformat:2 }}</span>
                    {% else %}
                      <span class="text-danger">-${{ record.amount|floatformat:2 }}</span>
                    {% endif %}
                  </td>
                  <td>{{ record.cashier.username }}</td>
                  <td>{{ record.description|default:"N/A" }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="bi bi-cash-stack display-1 text-muted"></i>
            <h4 class="text-muted mt-3">No Financial Records</h4>
            <p class="text-muted">No financial records found for your store.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Back Button -->
  <div class="mt-4">
    <a href="{% url 'store_manager_page' %}" class="btn btn-secondary">
      <i class="bi bi-arrow-left"></i> Back to Dashboard
    </a>
  </div>
</div>

<script>
// Initialize Bootstrap tabs
var triggerTabList = [].slice.call(document.querySelectorAll('#salesTabs button'))
triggerTabList.forEach(function (triggerEl) {
  var tabTrigger = new bootstrap.Tab(triggerEl)
  triggerEl.addEventListener('click', function (event) {
    event.preventDefault()
    tabTrigger.show()
  })
})
</script>
{% endblock %}
