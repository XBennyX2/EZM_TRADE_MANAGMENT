{% extends 'base.html' %}

{% block content %}
<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
  .stock-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: none;
    border-radius: 0.75rem;
    box-shadow: 0 0.25rem 1rem rgba(0, 0, 0, 0.05);
  }

  .stock-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1);
  }

  .stock-header {
    background: linear-gradient(90deg, #4CAF50, #45a049);
    color: white;
    border-radius: 0.75rem 0.75rem 0 0;
    padding: 1rem 1.5rem;
  }

  .low-stock {
    background-color: #fff3cd;
    border-left: 4px solid #ffc107;
  }

  .out-of-stock {
    background-color: #f8d7da;
    border-left: 4px solid #dc3545;
  }

  .good-stock {
    background-color: #d1edff;
    border-left: 4px solid #0d6efd;
  }
</style>

<div class="container mt-4">
  <!-- Header -->
  <div class="stock-card mb-4">
    <div class="stock-header">
      <h3 class="mb-0"><i class="bi bi-clipboard-data"></i> Stock Management - {{ manager_store.name }}</h3>
    </div>
    <div class="card-body">
      <p class="mb-0">View your store's inventory and monitor stock levels across all showrooms.</p>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <ul class="nav nav-tabs mb-4" id="stockTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="own-stock-tab" data-bs-toggle="tab" data-bs-target="#own-stock" type="button" role="tab">
        <i class="bi bi-house-door"></i> My Store Stock
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="other-stock-tab" data-bs-toggle="tab" data-bs-target="#other-stock" type="button" role="tab">
        <i class="bi bi-shop"></i> Other Showrooms
      </button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content" id="stockTabsContent">
    <!-- Own Store Stock Tab -->
    <div class="tab-pane fade show active" id="own-stock" role="tabpanel">
      <div class="card stock-card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-boxes"></i> {{ manager_store.name }} - Stock Levels</h5>
        </div>
        <div class="card-body">
          {% if own_stock %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Product</th>
                  <th>Category</th>
                  <th>Quantity</th>
                  <th>Selling Price</th>
                  <th>Low Stock Threshold</th>
                  <th>Status</th>
                  <th>Last Updated</th>
                </tr>
              </thead>
              <tbody>
                {% for stock in own_stock %}
                <tr class="{% if stock.quantity == 0 %}out-of-stock{% elif stock.quantity <= stock.low_stock_threshold %}low-stock{% else %}good-stock{% endif %}">
                  <td><strong>{{ stock.product.name }}</strong></td>
                  <td>{{ stock.product.category }}</td>
                  <td>
                    <span class="badge {% if stock.quantity == 0 %}bg-danger{% elif stock.quantity <= stock.low_stock_threshold %}bg-warning{% else %}bg-success{% endif %}">
                      {{ stock.quantity }}
                    </span>
                  </td>
                  <td>${{ stock.selling_price }}</td>
                  <td>{{ stock.low_stock_threshold }}</td>
                  <td>
                    {% if stock.quantity == 0 %}
                      <span class="badge bg-danger">Out of Stock</span>
                    {% elif stock.quantity <= stock.low_stock_threshold %}
                      <span class="badge bg-warning">Low Stock</span>
                    {% else %}
                      <span class="badge bg-success">In Stock</span>
                    {% endif %}
                  </td>
                  <td>{{ stock.last_updated|date:"M d, Y H:i" }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="bi bi-inbox display-1 text-muted"></i>
            <h4 class="text-muted mt-3">No Stock Items</h4>
            <p class="text-muted">Your store doesn't have any stock items yet.</p>
            <a href="{% url 'stock_create' %}" class="btn btn-primary">
              <i class="bi bi-plus-circle"></i> Add Stock Item
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Other Stores Stock Tab -->
    <div class="tab-pane fade" id="other-stock" role="tabpanel">
      <div class="card stock-card">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="bi bi-shop"></i> Other Showrooms - Stock Overview</h5>
        </div>
        <div class="card-body">
          {% if other_stores_stock %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Store</th>
                  <th>Product</th>
                  <th>Category</th>
                  <th>Quantity</th>
                  <th>Selling Price</th>
                  <th>Status</th>
                  <th>Last Updated</th>
                </tr>
              </thead>
              <tbody>
                {% for stock in other_stores_stock %}
                <tr>
                  <td><strong>{{ stock.store.name }}</strong></td>
                  <td>{{ stock.product.name }}</td>
                  <td>{{ stock.product.category }}</td>
                  <td>
                    <span class="badge {% if stock.quantity == 0 %}bg-danger{% elif stock.quantity <= stock.low_stock_threshold %}bg-warning{% else %}bg-success{% endif %}">
                      {{ stock.quantity }}
                    </span>
                  </td>
                  <td>${{ stock.selling_price }}</td>
                  <td>
                    {% if stock.quantity == 0 %}
                      <span class="badge bg-danger">Out of Stock</span>
                    {% elif stock.quantity <= stock.low_stock_threshold %}
                      <span class="badge bg-warning">Low Stock</span>
                    {% else %}
                      <span class="badge bg-success">In Stock</span>
                    {% endif %}
                  </td>
                  <td>{{ stock.last_updated|date:"M d, Y H:i" }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="bi bi-shop display-1 text-muted"></i>
            <h4 class="text-muted mt-3">No Other Stores</h4>
            <p class="text-muted">There are no other stores with stock items.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Back Button -->
  <div class="mt-4">
    <a href="{% url 'store_manager_page' %}" class="btn btn-secondary">
      <i class="bi bi-arrow-left"></i> Back to Dashboard
    </a>
  </div>
</div>

<script>
// Initialize Bootstrap tabs
var triggerTabList = [].slice.call(document.querySelectorAll('#stockTabs button'))
triggerTabList.forEach(function (triggerEl) {
  var tabTrigger = new bootstrap.Tab(triggerEl)
  triggerEl.addEventListener('click', function (event) {
    event.preventDefault()
    tabTrigger.show()
  })
})
</script>
{% endblock %}
